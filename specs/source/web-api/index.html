<!DOCTYPE html> 
<html> 
  <head> 
    <title>PaySwarm 1.0 - Web API</title> 
    <meta http-equiv='Content-Type' content='text/html;charset=utf-8'/> 
    <!-- 
      === NOTA BENE ===
      For the three scripts below, if your spec resides on dev.w3 you can check them
      out in the same tree and use relative links so that they'll work offline,
     --> 
    <script src='../../respec/js/respec.js' class='remove'></script> 
    <script type="text/javascript" class="remove">
    var preProc = {
          apply:  function(c) {
                    // extend the bibliography entries
                    berjon.biblio["HTML-RDFA"] = "Manu Sporny; et al. <a href=\"http://www.w3.org/TR/rdfa-in-html/\"><cite>HTML+RDFa</cite></a> 04 March 2010. W3C Working Draft. URL: <a href=\"http://www.w3.org/TR/rdfa-in-html/\">http://www.w3.org/TR/rdfa-in-html/</a> ";
                    berjon.biblio["JSON-LD"] = "Manu Sporny; Gregg Kellogg; Dave Longley; et al. <a href=\"http://json-ld.org/spec/latest/\"><cite>JSON-LD</cite></a> latest. W3C Community Group Working Draft. URL: <a href=\"http://json-ld.org/spec/latest/\">http://json-ld.org/spec/latest/</a> ";
                    berjon.biblio["REST"] = "Fielding, Roy Thomas. <a href=\"http://www.ics.uci.edu/~fielding/pubs/dissertation/\"><cite>Architectural Styles and the Design of Network-based Software Architectures</cite></a> 2000. University of California, Irvine. URL: <a href=\"http://www.ics.uci.edu/~fielding/pubs/dissertation/\">http://www.ics.uci.edu/~fielding/pubs/dissertation/</a>";
                    berjon.biblio["FIPS-197"] = "Information Technology Laboratory. <a href=\"http://csrc.nist.gov/publications/fips/fips197/fips-197.pdf\"><cite>Specification for the ADVANCED ENCRYPTION STANDARD (AES)</cite></a> November 26th, 2001. Department of Commerce, National Institute of Standards and Technology. URL: <a href=\"http://csrc.nist.gov/publications/fips/fips197/fips-197.pdf\">http://csrc.nist.gov/publications/fips/fips197/fips-197.pdf</a>";

                    // process the document before anything else is done
                    var refs = document.querySelectorAll('adef') ;
                    for (var i = 0; i < refs.length; i++) {
                        var item = refs[i];
                        var p = item.parentNode ;
                        var con = item.innerHTML ;
                        var sp = document.createElement( 'dfn' ) ;
                        var tit = item.getAttribute('title') ;
                        if (!tit) {
                            tit = con;
                        }
                        sp.className = 'adef' ;
                        sp.title=tit ;
                        sp.innerHTML = con ;
                        p.replaceChild(sp, item) ;
                    }
                    refs = document.querySelectorAll('aref') ;
                    for (var i = 0; i < refs.length; i++) {
                        var item = refs[i];
                        var p = item.parentNode ;
                        var con = item.innerHTML ;
                        var sp = document.createElement( 'a' ) ;
                        sp.className = 'aref' ;
                        sp.setAttribute('title', con);
                        sp.innerHTML = '@'+con ;
                        p.replaceChild(sp, item) ;
                    }
                    // local datatype references
                    refs = document.querySelectorAll('ldtref') ;
                    for (var i = 0; i < refs.length; i++) {
                        var item = refs[i];
                        if (!item) continue ;
                        var p = item.parentNode ;
                        var con = item.innerHTML ;
                        var ref = item.getAttribute('title') ;
                        if (!ref) {
                            ref = item.textContent ;
                        }
                        if (ref) {
                            ref = ref.replace(/\n/g, '_') ;
                            ref = ref.replace(/\s+/g, '_') ;
                        }
                        var sp = document.createElement( 'a' ) ;
                        sp.className = 'datatype';
                        sp.title = ref ;
                        sp.innerHTML = con ;
                        p.replaceChild(sp, item) ;
                    }
                    // external datatype references
                    refs = document.querySelectorAll('dtref') ;
                    for (var i = 0; i < refs.length; i++) {
                        var item = refs[i];
                        if (!item) continue ;
                        var p = item.parentNode ;
                        var con = item.innerHTML ;
                        var ref = item.getAttribute('title') ;
                        if (!ref) {
                            ref = item.textContent ;
                        }
                        if (ref) {
                            ref = ref.replace(/\n/g, '_') ;
                            ref = ref.replace(/\s+/g, '_') ;
                        }
                        var sp = document.createElement( 'a' ) ;
                        sp.className = 'externalDFN';
                        sp.title = ref ;
                        sp.innerHTML = con ;
                        p.replaceChild(sp, item) ;
                    }
                    // now do terms
                    refs = document.querySelectorAll('tdef') ;
                    for (var i = 0; i < refs.length; i++) {
                        var item = refs[i];
                        if (!item) continue ;
                        var p = item.parentNode ;
                        var con = item.innerHTML ;
                        var ref = item.getAttribute('title') ;
                        if (!ref) {
                            ref = item.textContent ;
                        }
                        if (ref) {
                            ref = ref.replace(/\n/g, '_') ;
                            ref = ref.replace(/\s+/g, '_') ;
                        }
                        var sp = document.createElement( 'dfn' ) ;
                        sp.title = ref ;
                        sp.innerHTML = con ;
                        p.replaceChild(sp, item) ;
                    }
                    // now term references
                    refs = document.querySelectorAll('tref') ;
                    for (var i = 0; i < refs.length; i++) {
                        var item = refs[i];
                        if (!item) continue ;
                        var p = item.parentNode ;
                        var con = item.innerHTML ;
                        var ref = item.getAttribute('title') ;
                        if (!ref) {
                            ref = item.textContent ;
                        }
                        if (ref) {
                            ref = ref.replace(/\n/g, '_') ;
                            ref = ref.replace(/\s+/g, '_') ;
                        }

                        var sp = document.createElement( 'a' ) ;
                        var id = item.textContent ;
                        sp.className = 'tref' ;
                        sp.title = ref ;
                        sp.innerHTML = con ;
                        p.replaceChild(sp, item) ;
                    }
                }
        } ;

      var respecConfig = {
          // specification status (e.g. WD, LCWD, NOTE, etc.). If in doubt use ED.
          specStatus:           "unofficial",
          
          // the specification's short name, as in http://www.w3.org/TR/short-name/
          shortName:            "payswarm",
 
          // if you wish the publication date to be other than today, set this
          // publishDate:  "2009-08-06",
 
          // if there is a previously published draft, uncomment this and set its YYYY-MM-DD date
          // and its maturity status
          // previousPublishDate:  "1977-03-15",
          // previousMaturity:  "WD",
 
          // if there a publicly available Editor's Draft, this is the link
          edDraftURI:           "http://payswarm.com/specs/source/payswarm/",
 
          // if this is a LCWD, uncomment and set the end of its review period
          // lcEnd: "2009-08-05",
 
          // if you want to have extra CSS, append them to this list
          // it is recommended that the respec.css stylesheet be kept
          extraCSS:             ["../../respec/css/respec.css", "spec.css"],
 
          // editors, add as many as you like
          // only "name" is required
          editors:  [
              { name: "Manu Sporny", url: "http://digitalbazaar.com/",
                company: "Digital Bazaar, Inc.", companyURL: "http://digitalbazaar.com/" },
          ],
 
          // authors, add as many as you like. 
          // This is optional, uncomment if you have authors as well as editors.
          // only "name" is required. Same format as editors.
 
          //authors:  [
          //    { name: "Your Name", url: "http://example.org/",
          //      company: "Your Company", companyURL: "http://example.com/" },
          //],
          additionalCopyrightHolders: "Copyright 2009-2011 &copy; Digital Bazaar, Inc.",
          
          // name of the WG
          wg:           "W3C Web Payments Community Group",
          
          // URI of the public WG page
          wgURI:        "http://payswarm.com/",
          
          // name (with the @w3c.org) of the public mailing to which comments are due
          wgPublicList: "public-webpayments@w3c.org",
          
          // URI of the patent status for this WG, for Rec-track documents
          // !!!! IMPORTANT !!!!
          // This is important for Rec-track documents, do not copy a patent URI from a random
          // document unless you know what you're doing. If in doubt ask your friendly neighbourhood
          // Team Contact.
          wgPatentURI:  "",
          maxTocLevel: 4,
          preProcess: [ preProc ],
          //alternateFormats: [ {uri: "diff-20110920.html", label: "diff to previous version"} ],
      };
    </script> 
    <link href="prettify.css" type="text/css" rel="stylesheet" />
    <script type="text/javascript" src="prettify.js" class="remove"></script>
    <script type="text/javascript" src="lang-jsonld.js" class="remove"></script>
    <script type="text/javascript" class="remove">
      var oldonload = window.onload;
      window.onload = function() {
        if (oldonload) oldonload();
        prettyPrint();
      };
    </script>
  </head> 
  <body> 
    <section id='abstract'> 
      <p>
The PaySwarm Web platform is an open web standard that enables Web browsers and 
Web devices to perform Universal Web Payment. PaySwarm enables the people that 
create digital content such as blog posts, music, film, episodic content, 
photos, virtual goods, and documents to distribute their creations through 
their website and receive payment directly from their fans and customers. The 
technology is designed to be integrated directly into blogging platforms, 
content management systems and general purpose websites. The standard can
be applied to the entire content distribution lifecycle, from asset description, 
to product listings, to licenses, contracts and financial transactions. 
Features include the ability to exchange money, transact individual sales, 
subscriptions and micropayments.
      </p> 
    </section> 

    <section>
      <h2>Introduction</h2>
      <p>
The PaySwarm Web platform is an open web standard that enables Web browsers and 
Web devices to perform Universal Web Payment. PaySwarm enables the people that 
create digital content such as blog posts, music, film, episodic content, 
photos, virtual goods, and documents to distribute their creations through 
their website and receive payment directly from their fans and customers. The 
technology is designed to be integrated directly into blogging platforms, 
content management systems and general purpose websites.
      </p>
      <p>
The technology is provided as an open web platform, which is a combination of 
technology that is patent-free, royalty-free, published in a free 
specification, using well-defined protocols and other open technologies. The 
entire PaySwarm standard, like HTML, HTTP, and JavaScript, is an open web 
platform. Almost every successful Web technology is built and released in 
this way.
      </p>      
      <p>
PaySwarm supports Micropayments. The standard assumes that customers do not
want to be bothered to reach for their wallet every time they need to spend a 
couple of cents, or even a couple of dollars. Micropayment in this case, 
specifically refers to the ability to automatically distribute payments in 
increments of up to 1/100,000th of a cent to anybody listed in PaySwarm 
digital contracts.
      </p>
      <p>
It is the goal of this specification to create an environment that is friendly
to content creators and customers alike. Distribution of digital goods is
becoming an increasing part of the Web and therefore compensation for these
digital goods must be as easy to perform as downloading the digital goods. The
PaySwarm specification works with the architecture of the Web to deliver a
solution that is universal across websites, industries and countries.
      </p>
    </section>

    <section>
      <h2>The Conceptual Model</h2>
      <p>
There are three primary participants in a PaySwarm transaction; the 
asset acquirer, the asset owner, and the PaySwarm Authority.
      </p>
      <section>
        <h3>Identity and Identifiers</h3>
        <p>
In order for a universal payment system to work seamlessly, there must be a
universal way of identifying <em>things</em> in the environment. This 
specification uses Internationalized Resource Identifiers [[!IRI]] to 
refer to <em>things</em> on the network. These things can be a personal identity 
(<code>https://example.com/people/bob</code>), 
financial account information 
(<code>https://example.com/people/bob/accounts/42</code>), public cryptography
keys (<code>https://example.com/people/bob/keys/14</code>), assets, licenses 
and a variety of other pieces of long-lived information that exists on the Web. 
By naming these things with long-lived unique identifiers, it becomes possible 
to create a decentralized but stable universal payment architecture.
        </p>
      </section>
      <section>
        <h3>Participants</h3>
        <section>
          <h4>Asset Acquirers</h3>
          <p>
An <tdef>asset acquirer</tdef>, more commonly known as a buyer, is an entity 
that is capable 
of acquiring the rights to a particular asset via a Contract. The entity is 
typically a person or an organization that would like to view, copy or 
otherwise utilize the asset that is being acquired.
          </p>
        </section>
        <section>
          <h4>Asset Providers</h3>
          <p>
An <tdef>asset provider</tdef>, more commonly known as an owner, is the entity 
providing an asset for sale. Typically, the asset provider is the legal owner 
of the asset that is being listed for sale. Ownership of an asset can manifest 
in a variety of different forms. Copyright ownership, physical ownership, and 
sub-leased property or services are just a few of the types of ownership that 
apply to asset providers.
          </p>
        </section>
        <section>
          <h4>PaySwarm Authorities</h3>
          <p>
A <tdef>PaySwarm Authority</tdef> is used to store money, process and store 
contracts, and 
transfer monetary amounts between financial accounts. While a PaySwarm 
Authority may hold a great deal of financial data, they are built with
data portability in mind. PaySwarm participants may move their money and
purchase history from one authority to another. Data portability is a mandatory
part of this specification.
          </p>
        </section>
      </section>
      <section>
        <h3>Commerce Model</h3>
        <section>
          <h4>Assets</h3>
An <tdef>asset</tdef> describes a particular item that is provided as a part 
of a commercial
transaction. It is usually an item that can be accessed or acquired on the
basis of a sale or rental under the terms of a particular license. Examples
of assets include web pages, crowd-funded loans or grants, music files, 
video streams, use of virtual machines by the hour, 
3D printer files for on-demand manufacturing, radio 
spectrum and many other items that are capable of being transacted.
          <p>
          </p>
        </section>
        <section>
          <h4>Licenses</h3>
          <p>
A <tdef>license</tdef> is a legal description of a licensee's rights to a 
particular <tref>asset</tref>.
Licenses are usually included as a part of a contract to express what a buyer 
may do with the asset that has been purchased.
          </p>
        </section>
        <section>
          <h4>Listings</h3>
          <p>
A <tdef>listing</tdef> describes the combination of an <tref>asset</tref> that 
is for sale under a specific <tref>license</tref> and a set of payment terms 
that must be fulfilled in order 
to access the <tref>asset</tref>. Listings are often published on websites that 
sell <tref>assets</tref> via PaySwarm as a way to express wares for sale in a 
decentralized manner.
          </p>
        </section>
        <section>
          <h4>Contracts</h3>
          <p>
A <tdef>contract</tdef> is the result of a commercial transaction in PaySwarm 
and contains
information such as the <tref>listing</tref>, the <tref>asset</tref> that was 
purchased, the parties involved in the transaction, the <tref>license</tref> 
outlining the rights to the <tref>asset</tref>, and payment information 
associated with the transaction.
          </p>
        </section>
      </section>      
    </section>

    <section>
      <h2>Base Technologies</h2>
      <p>
PaySwarm builds on a number of successful Internet and Web technologies. These
technologies are introduced in this section.
      </p>

      <section>
        <h3>Representational State Transfer</h3>
        <p>
REpresentational State Transfer [[REST]] is the architectural style that underpins
the World Wide Web. It consists of a set of constraints to ensure that servers,
gateways, proxies and clients may interact in a way that is predictable.
Systems that are designed with this architecture in mind are called RESTful
systems. PaySwarm is designed to be RESTful by ensuring that the constraints of
REST are applied to all transactions performed via PaySwarm systems.
        </p>
      </section>

      <section>
        <h3>JavaScript Object Notation for Linking Data</h3>
        <p>
JavaScript Object Notation for Linking Data [[!JSON-LD]] is a lightweight Linked 
Data format. It is easy for humans to read and write. It is easy for machines 
to parse and generate. It is based on the already successful JSON format and 
provides a way to help JSON data interoperate at Web-scale. If you are already 
familiar with JSON, writing JSON-LD is very easy. There is a smooth migration 
path from the JSON you use today, to the JSON-LD you will use in the future. 
These properties make JSON-LD an ideal Linked Data interchange language for 
JavaScript environments, Web services, and JSON document-based databases.
        </p>
      </section>

      <section>
        <h3>The Advanced Encryption Standard</h3>
        <p>
The Advanced Encryption Standard (AES) [[!FIPS-197]] is a world standard 
adopted by the
United States Government and used to secure a vast majority of the
commercial transactions over the Internet via OpenSSL. Since much of the data
exchanged over PaySwarm participants is sensitive, it is important that a 
strong cryptography suite is utilized to digitally sign and transfer the 
messages.
        </p>
      </section>

      <section>
        <h3>HTML+RDFa</h3>
        <p>
Web sites are largely implemented on top of the HyperText Markup Language 
(HTML). This format is known to be fairly easy to author and publish on the Web.
In addition to being easy to publish, it is also important that data published
via HTML can be easily read by machines without placing an undue burden on
Web authors. Publishing structured data in a decentralized manner also 
requires a language that is capable of being both expressive and deterministic. 
The Resource Description Framework in attributes [[!RDFA-CORE]] extends HTML 
[[!HTML-RDFA]] to allow structured data to be expressed via HTML, but in a way 
that is easy for Web developers to author.
        </p>
      </section>
    </section>

    <section>
      <h2>Communication</h2>
      <p>
All communication between software operating under this specification is
intended to perform according to REST [[REST]] principles. Additionally, since
PaySwarm implements a financial system, the security of messages and data
is of paramount importance. A security breach at certain points during the 
algorithms described in the following sections may introduce attack vectors 
that criminals could utilize to steal from or cause financial harm to the 
systems or people involved. However, excellent security does not have to 
come at a high cost. PaySwarm has been designed so that many parts of the 
system can be implemented in a way that does not incur significant 
effort, recurring costs, or financial outlay.
      </p>

      <section>
        <h2>Requests and Responses</h2>
        <p>
This specification requires that a <tref>PaySwarm Authority</tref> 
have a trusted security certificate and operate many of the API services over 
Transport Layer Security version 1.0 or later. Unless otherwise 
specified, all API requests
MUST be made over HTTPS to the <tref>PaySwarm Authority</tref>.
        </p>
        <p>
An invalid certificate or TLS error or any kind MUST result in the API 
call exiting immediately and not performing the requested
action. All API requests sent to the <tref>PaySwarm Authority</tref> on 
behalf of a participant of the network that results in any modification 
to an internal database MUST be digitally signed by the requestor using the
steps provided in the <a href="request-signature-algorith">Request Signature
Algorithm</a>. All responses to network participants from a
<tref>PaySwarm Authority</tref> MUST be encrypted according to the steps
provided in the
<a href="request-signature-algorith">Response Encryption Algorithm</a>.
        </p>
      </section>

      <section>
        <h2>Communication Terms</h2>
        <p>
The following terminology is used to describe concepts used to generate and 
secure messages in the system. Many of these terms are borrowed from 
public/private key cryptography. A more complete description of public/private 
cryptography can be found in The Advanced Encryption Standard [[AES]].
        </p>
        
        <dl>
          <dt><tdef>message</tdef></dt>
          <dd>
A JSON-LD byte stream that is used to convey a request or a response in the 
system.
          </dd>
          <dt><tdef>public key</tdef></dt>
          <dd>
A cryptographic mechanism that can be used to verify digital signatures or
encrypt small messages such that only the software with access to the
corresponding <tref>private key</tref> can decrypt the small message.
          </dd>
          <dt><tdef>private key</tdef></dt>
          <dd>
A cryptographic mechanism that can be used to generate digital signatures and
decrypt encrypted data.
          </dd>
          <dt><tdef>signed message</tdef></dt>
          <dd>
A type of message that has a digital signature attached to it, generated using
a <tref>private key</tref>, that is verifiable and incredibly difficult to
forge.
          </dd>
          <dt><tdef>nonce</tdef></dt>
          <dd>
A value attached to <tref>signed message</tref>s and API callbacks,
typically used to prevent 
<a href="http://en.wikipedia.org/wiki/Replay_attack">replay attacks</a>.
          </dd>
          <dt><tdef>encrypted message</tdef></dt>
          <dd>
A type of message that has been obfuscated using a <tref>public key</tref>,
which is incredibly difficult to decode by any person except for the one
that holds the associated <tref>private key</tref>.
          </dd>
        </dl>
        
      </section>

      <section>
        <h2>Request Signature Algorithm</h2>
        <p>
The following algorithm ensures that the originator of an API call can be
verified as long as the public key can be retrieved by the receiver. A
<tref>message</tref> is provided as input and, using a
<tref>private key</tref> and a <tref>public key</tref> IRI, a
<tref>signed message</tref> is produced as output.
        </p>
        
        <ol class="algorithm">
          <li>
Remove any <code>sec:signature</code> key-value pair from the top-level of the
<tref>message</tref>. Copy the <tref>message</tref> to the 
<tref>signed message</tref>.
          </li>
          <li>
Generate the <tdef>normalized message</tdef> by normalizing the 
<tref>message</tref> according to the 
<a href="http://json-ld.org/spec/ED/20110911#normalization-1">JSON-LD 
UGNA2011 Normalization Algorithm</a>.
          </li>
          <li>
Generate the <tdef>signature value</tdef> by:
            <ol class="algorithm">
              <li>
Generate a <tdef>nonced message</tdef> by setting its value to the value
of a generated <tref>nonce</tref>. It is vital that the generated 
<tref>nonce</tref> value has never been used in the previous hour. Append the 
<tref>normalized message</tref> to the <tref>nonced message</tref>.
              </li>
              <li>
Generate an ISO8601 <tdef>combined date and time string</tdef> containing the
current date and time, accurate to at least one second, in Universal Time
Code format. For example: <code>2011-09-23T20:21Z</code>. Append the
<tref>combined date and time string</tref> to the <tref>nonced message</tref>.
              </li>
              <li>
Digitally sign the <tref>nonced message</tref> using the 
<tref>private key</tref> and then base-64 encode the resulting value. The 
resulting base-64 encoded string is the <tref>signature value</tref>.
              </li>
            </ol>
          <li>
Add a <code>sec:signature</code> key to the <tref>signed message</tref> with
a JSON object containing the following key-value pairs:
            <dl style="margin-left: 1em;">
              <dt><code>@type</code><dt>
              <dd><code>sig:JsonLdSignature</code></dd>
              <dt><code>dc:created</code><dt>
              <dd>
The string value of the <tref>combined date and time string</tref> generated
by this algorithm.
              </dd>
              <dt><code>sec:nonce</code><dt>
              <dd>
The string value of the <tref>nonce</tref> generated by this algorithm.
              </dd>
              <dt><code>sec:publicKey</code><dt>
              <dd>The value of the input <tref>public key</tref> IRI.</dd>
              <dt><code>sec:signatureValue</code><dt>
              <dd>
The value of the <tref>signature value</tref> generated by this algorithm.
              </dd>
            </dl>
          </li>
        </ol>

        <p>
The following example shows an input <tref>message</tref> and the resulting
<tref>signed message</tref>:
        </p>

        <pre class="example">
*** message
{
   "@context": "http://purl.org/payswarm/v1",
   "dc:title": "Hello World!"
}

*** signed message
{
   "@context": "http://purl.org/payswarm/v1",
   "dc:title": "Hello World!",
   "sec:signature":
   {
      "@type": "sec:JsonLdSignature",
      "dc:created": "2011-09-23T20:21Z",
      "sec:nonce": "23478923",
      "sec:signer": "http://payswarm.example.com/i/john/keys/5",
      "sec:signatureValue": "OGQzNGVkMzVm4NTIyZTkZDYMmMzQzNmExMgoYzI43Q3ODIyOWM32NjI="
   }
}
        </pre>

      </section>

      <section>
        <h2>Request Signature Verification Algorithm</h2>
        <p>
In order to ensure a secure communication environment the following algorithm
SHOULD be used to verify all request signatures in the system. A
<tref>signed message</tref> is provided as input and an indication of whether
the signature is valid or a forgery is produced as output.
        </p>
        
        <ol class="algorithm">
          <li>
Generate the <tdef>original message</tdef> by copying the 
<tref>signed message</tref> and removing the <code>sec:signature</code> value
from the <tref>original message</tref>.
          </li>
          <li>
Generate the <tdef>original normalized message</tdef> by normalizing the 
<tref>original message</tref> according to the 
<a href="http://json-ld.org/spec/ED/20110911#normalization-1">JSON-LD 
UGNA2011 Normalization Algorithm</a>.
          </li>
          <li>
Verify the <tdef>original signature value</tdef>:
            <ol class="algorithm">
              <li>
Generate the <tdef>original nonced message</tdef> by setting its value to 
the value of the <code>sec:nonce</code> key in the 
<tref>signed message</tref>. Append the value of the 
<code>dc:created</code> key in the <tref>signed message</tref> to the 
<tref>original nonced message</tref>. Finally, append the
<tref>original normalized message</tref> to the 
<tref>original nonced message</tref>.
              </li>
              <li>
Retrieve the PEM-encoded <tref>public key</tref> from the
<tref>public key</tref> IRI provided in
<code>sec:signer</code> value. The <tref>public key</tref> MAY also be retrieved
from a cache. ???Verify the <tref>original nonced message</tref>
using the <tref>public key</tref>??? 
<div class="note">We need to be more explicit about what is happening here.</div>
              </li>
            </ol>
        </ol>
      </section>

      <section>
        <h2>Response Encryption Algorithm</h2>
        <p>
The following algorithm ensures that a message intended for a particular
recipient can be obfuscated such that only the intended recipient can read the
message. A <tref>message</tref> is provided as input and, using a
<tref>public key</tref> and a <tref>public key</tref> IRI, a 
<tref>encrypted message</tref> is produced as output.
        </p>
        
        <ol class="algorithm">
          <li>
Generate a crypto-graphically strong <tdef>symmetric key</tdef> that is exactly 16 bytes in length.
          </li>
          <li>
Generate an <tdef>initialization vector</tdef> that is exactly 16 bytes in 
length.
          </li>
          <li>
Generate the <tdef>encrypted data</tdef> by encrypting the <tref>message</tref>
using the RSA with AES 128-bit Cyclic Block Chaining algorithm, using the
<tref>symmetric key</tref> and the <tref>initialization vector</tref>
generated previously in this algorithm.
          </li>
          <li>
Generate the <tdef>encrypted password</tdef> by using the 
<tref>public key</tref> to encrypt the <tref>symmetric key</tref>.
          </li>
Generate the <tref>encrypted message</tref> by creating a JSON object
containing the following key-value pairs:
            <dl style="margin-left: 1em;">
              <dt><code>@type</code><dt>
              <dd><code>sec:EncryptedMessage</code></dd>
              <dt><code>sec:data</code><dt>
              <dd>
The base-64 encoded value of the <tref>encrypted data</tref>.
              </dd>
              <dt><code>sec:encryptionKey</code><dt>
              <dd>
The base-64 encoded value of the <tref>encrypted password</tref>.
              </dd>
              <dt><code>sec:cipher</code><dt>
              <dd>
The value <code>rsa-aes-128-cbc</code>.
              </dd>
              <dt><code>sec:iv</code><dt>
              <dd>
The base-64 encoded value of the <tref>initialization vector</tref>.
              </dd>
              <dt><code>sec:publicKey</code><dt>
              <dd>
The <tref>public key</tref> IRI associated with the <tref>public key</tref>
that was used to encrypt the <tref>symmetric key</tref> in this
algorithm.
              </dd>
            </dl>
          </li>
        </ol>

        <p>
The following example shows a typical input message and what an encrypted
message looks like when generated using the algorithm above.
        </p>

        <pre class="example">
*** message
{
   "@type": "ps:Preferences"
   "com:currency": "USD",
   "com:minimumAmount": "0.05",
   "com:maximumRate": "10.0",
   "com:destination": "https://example.com/people/manu/accounts/article-sales",
   "sec:publicKey": "http://payswarm.example.com/i/manu/keys/23",
   "ps:license": "http://purl.org/payswarm/licenses/blogging",
   "ps:licenseHash": "961ec496092bf6ee08d6255d96069b5186332689",
}

*** encrypted message
{
   "@type": "sec:EncryptedMessage",
   "sec:data": "VTJGc2RHVmtYMThOY3h2dnNVN290Zks1dmxWc3labi9sYkU0TGloRTdxY0dpblE4OHgrUXFNNi9l\n↩
a1JMWjdXOApRSGtrbzh6UG5XOFo3WWI4djJBUG1abnlRNW5CVGViWkRGdklpMEliczNWSzRQTGdB\n↩
UFhxYTR2aWFtemwrWGV3Cmw0eFF4ancvOW85dTlEckNURjMrMDBKMVFubGdtci9abkFRSmc5UjdV\n↩
Rk55ckpYalIxZUJuKytaQ0luUTF2cUwKcm5vcDU1eWk3RFVqVnMrRXZZSkx6RVF1VlBVQ0xxdXR4\n↩
L3lvTWd4bkdhSksxOG5ZakdiekJxSGxOYm9pVStUNwpwOTJ1Q0Y0Q2RiR1NqL0U3OUp4Vmh6OXQr\n↩
Mjc2a1V3RUlNY3o2Z3FadXZMU004KzRtWkZiakh6K2N5a1VVQ2xHCi9RcTk3b2o3N2UrYXlhZjhS\n↩
ZmtEZzlUeWk3Q2szREhSblprcy9WWDJWUGhUOEJ5c3RiYndnMnN4eWc5TXhkbHoKUkVESzFvR0FJ\n↩
UDZVQ09NeWJLTGpBUm0zMTRmcWtXSFdDY29mWFNzSGNPRmM2cnp1Wko0RnVWTFNQMGROUkFRRgpB\n↩
bFQ0QUpPbzRBZHpIb2hpTy8vVGhNOTl1U1ZER1NPQ3graFAvY3V4dGNGUFBSRzNrZS8vUk1MVFZO\n↩
YVBlaUp2Ckg4L1ZWUVU4L3dLZUEyeTQ1TzQ2K2lYTnZsOGErbGg0NjRUS3RabktFb009Cg==",
   "sec:encryptionKey": "uATtey0c4nvZIsDIfpFffuCyMYGPKRLIVJCsvedE013SpEJ+1uO7x6SK9hIG9zLWRlPpwmbar2bt\n↩
gTX5NBzYC5+c5ZkXtM1O8REwIJ7wmtLdumRYEbr/TghFl3pAgXhv0mVt8XZ+KLWlxMqXnrT+ByNw\n↩
z7u3IxpqNVcXHExjXQE=",
   "sec:cipher": "rsa-aes-128-cbc",
   "sec:iv": "vcDU1eWTy8vVGhNOszREhSblFVqVnGpBUm0zMTRmcWtMrRX==",
   "sec:publicKey": "http://payswarm.example.com/i/manu/keys/23"
}
        </pre>
        
      </section>
    </section>

    <section>
      <h2>The Registration Process</h2>
      <p>
The registration process is necessary in order to specify details about
the participants in a PaySwarm transaction.
      </p>

      <section>
        <h2>Registration Terms</h2>
        <p>
There are a number of terms that are used during the course of the registration
process.
        <dl>
        <dt><tdef>user agent</tdef></dt>
        <dd>The piece of software operating on behalf of the 
<tref>asset acquirer</tref>. This is typically a Web Browser, but could be
some other piece of Web-aware automated software acting on behalf of a 
person.</dd>
        <dt><tdef>publishing agent</tdef></dt>
        <dd>A software agent acting on behalf of the <tref>asset provider</tref>
that publishes <tref>asset</tref>s for sale. Typically, this is blogging
software, content distribution software, online merchant software or a Web-based
game.</dd>
        <dt><tdef>configuration service</tdef></dt>
        <dd>A Web service that is used to publish the public Web service
end-points and other public configuration information for a
<tref>PaySwarm Authority</tref>. A <tref>PaySwarm Authority</tref> MUST
publish this service at a top-level IRI named <code>payswarm-v1-config</code>. 
The document MUST be available in JSON-LD compacted form and MUST use the
<code>http://purl.org/payswarm/v1</code> JSON-LD context. The following
keys MUST be present in the published document; 
<code>ps:publicKeyService</code>, <code>ps:licenseService</code>, and
<code>ps:contractsService</code>.</dd>
        <dt><tdef>public key service</tdef></dt>
        <dd>An interactive Web service used to register PEM-encoded 
X.509 public keys with the <tref>PaySwarm Authority</tref>.</dd>
        <dt><tdef>license service</tdef></dt>
        <dd>A utility service is used by a <tref>publishing agent</tref>s 
to retrieve license hashes, which are used when listing <tref>asset</tref>s 
for sale.</dd>
        <dt><tdef>contracts service</tdef></dt>
        <dd>The contract service is used to process purchases by submitting
and retrieving digital contracts.</dd>
        </dl>
        </p>
      </section>

      <section>
        <h2>Asset Acquirer Registration</h2>
        <p>
In order for an <tref>asset acquirer</tref> to transact, they must have an
account on a <tref>PaySwarm Authority</tref>. Typically, this account must 
also contain a positive amount of funds that may be used to acquire goods or 
services. How this account is created and funds are deposited are outside of
the scope of this specification. However, the end result of this sign up
process MUST result in the following items being created for the
<tref>asset acquirer</tref>:
        </p>
        <ol>
          <li>An <tdef>entity</tdef> IRI that will be used to identify the 
entity that is transacting. For example: 
<code>https://example.com/people/jane</code>.</li>
          <li>A <tdef>financial account</tdef> IRI that is associated with the 
<tref>entity</tref> IRI above. For example:
<code>https://example.com/people/jane/accounts/primary</code>.</li>
          <li>A positive amount of funds in the <tref>financial account</tref>
mentioned above.
        </ol>
      </section>

      <section>
        <h2>Asset Provider Registration</h2>
        <p>
In order for an <tref>asset provider</tref> to transact, they must have an
account on a PaySwarm Authority. How this account is created and managed is
outside of the scope of this specification. However, the end result of this
sign up process MUST result in the following items being created for the 
<tref>asset provider</tref>:
        </p>
        <ol class="algorithm">
          <li>An <tdef>entity</tdef> IRI that will be used to identify the 
entity that is transacting. For example: 
<code>https://example.com/people/manu</code>.</li>
          <li>A <tdef>financial account</tdef> IRI that is associated with the 
<tref>entity</tref> IRI above. For example:
<code>https://example.com/people/manu/accounts/article-sales</code>.</li>
        </ol>
        <p>
Since all <tref>asset</tref>s and <tref>listing</tref>s are digitally signed,
a public key MUST be registered for the 
<tref>asset provider</tref> with the <tref>PaySwarm Authority</tref>.
This is typically performed by the <tref>publishing agent</tref> software that 
is publishing the 
<tref>asset</tref>s and <tref>listing</tref>s for sale on behalf of the 
<tref>asset provider</tref>. The registration is accomplished by executing
the following algorithm:
        <ol class="algorithm">
          <li>The <tref>publishing agent<tref> generates and stores a 
public/private keypair that will be used to associate the
<tref>publishing agent</tref> with the <tref>asset provider</tref>.</li>
          <li>The <tref>publishing agent</tref> retrieves the 
<tref>PaySwarm Authority</tref> configuration from the 
<tref>configuration service</tref> IRI</tref>.
            <ol class="algorithm">
              <li>The <tref>configuration service</tref> IRI is generated 
by concatenating a base IRI for the <tref>PaySwarm Authority</tref>, 
such as <code>https://example.com/</code> with the 
<code>payswarm-v1-config</code> suffix. 
For example, the previous <tref>PaySwarm Authority</tref> IRI concatenated 
with the configuration suffix would result in the following 
<tref>configuration service</tref>
IRI: <code>https://example.com/payswarm-v1-config</code>.</li>
              <li>An HTTP GET is performed on the 
<tref>configuration service</tref> IRI with the
HTTP <code>Accept</code> header set to 
<code>application/ld+json; form=compacted</code>. The
<tref>PaySwarm Authority</tref> MUST respond with a compacted JSON-LD document
using the context specified at <code>http://purl.org/payswarm/v1</code>.</li>
              <li>The result MUST be a JSON-LD document containing a flat set of
key-value pairs defined in the <tref>configuration service</tref> section above.
              </li>
            </ol>
          </li>
          <li>
The <tref>publishing agent</tref> initiates an HTTP 302 redirect
for the <tref>user agent</tref>. An HTTP GET request is performed
to the <tref>public key service</tref> IRI with the addition of two IRI query 
parameters. The first parameter, <code>public-key</code>, is the 
URL-encoded X.509 PEM-encoded public key. The second parameter, 
<code>registration-callback</code>,
is the URL-encoded <tref>registration callback service</tref> 
IRI for the <tref>publishing agent</tref>.</li>
          <li>
The <tref>PaySwarm Authority</tref> associates the 
<tref>publishing agent</tref> with the <tref>asset provider</tref> based on the
provided public key. Note that is process MUST authenticate the 
<tref>asset provider</tref> via a login process if the 
<tref>asset provider</tref> does not have an active login session. Other
configuration steps may be performed at this stage, including the 
specification of defaults for the particular <tref>publishing agent</tref>.</li>
          <li>
The <tref>PaySwarm Authority</tref> specifies a set of 
<tref>publishing agent</tref> configuration values and, using the provided
public key, encrypts and base-64 encodes the value. The result is sent 
back to the <code>registration-callback</code> IRI via an HTTP POST 
initiated by the <tref>user agent</tref>.
            <ol class="algorithm">
              <li>The following configuration values MUST be included in the
JSON-LD response to the <tref>publishing agent</tref>; 
<code>com:currency</code>, <code>com:minimumAmount</code>, 
<code>com:maximumRate</code>, <code>com:destination</code>, 
<code>sec:publicKey</code>, <code>ps:license</code> and 
<code>ps:licenseHash</code>.
              </li>
              <li>The JSON-LD response is compacted and encrypted using the
public key associated with the registration request according to the
algorithm defined in <a href="#response-encryption">Response Encryption</a>.
              </li>
              <li>The <tref>encrypted response</tref> is transmitted to the
<code>registration-callback</code> via an HTTP POST request that is initiatited
by the <tref>user agent</tref>. This is most commonly accomplished by having
the <tref>PaySwarm Authority</tref> generate an HTML form that can be submitted
to the <tref>publishing agent</tref> when a form submission button is clicked
via the <tref>user agent</tref>.
              <li>The <tref>publishing agent</tref> decrypts the base-64
encoded byte stream, extracts the configuration values and stores each value
for use during the latter parts of the publishing and purchase process.</li>
            </ol>
          </li>
        </ol>
        </p>

        <p>
The example below shows the full protcol-level exchange between the
<tref>publishing agent</tref> and the <tref>PaySwarm Authority</tref>. For
the sake of brevity, not every optional parameter is included, just the bare
minimum necessary to perform the <tref>asset provider</tref> registration.
        </p>

<pre class="example">
--------------------------------- Step #1 -----------------------------------

*** Request: user agent -> publishing agent

POST /register-blog HTTP/1.1
Host: publisher.example.org
Content-Length: 47
Content-Type: application/x-www-form-urlencoded

payswarm-authority=http%3A%2F%2Fpayswarm.example.com%2F

*** publishing agent generates and stores public/private keypair

-----BEGIN PUBLIC KEY-----
MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDptIkqrXhx7YVGsBZ5fY/Lz0il
0LXJrhUY43V/lLWdRf7JXY6tcgA5AmwNGZtJRyH79QXCJn+BAHUtl6gX2gvjs8N2
B5u4m0LtXyaFWtbQV9+hY3JRLOBiydPeXLgsnLwKiJ9v4CNXSNA5wT8vYGXiqq0B
US89y0M909ZTj2zDQwIDAQAB
-----END PUBLIC KEY-----

-----BEGIN RSA PRIVATE KEY-----
MIICXQIBAAKBgQDptIkqrXhx7YVGsBZ5fY/Lz0il0LXJrhUY43V/lLWdRf7JXY6t
cgA5AmwNGZtJRyH79QXCJn+BAHUtl6gX2gvjs8N2B5u4m0LtXyaFWtbQV9+hY3JR
LOBiydPeXLgsnLwKiJ9v4CNXSNA5wT8vYGXiqq0BUS89y0M909ZTj2zDQwIDAQAB
AoGALNmBrVgHEk4T0qH+XihTjThlZ7Tq/h5TXChipy5BwEHriHdU50JGeqpVVBpC
68gj5Hd8OGss8vPEiRBeqN0mhJlRaX5ijyFp2n8+7DhfOIVhCd1MXCGQPTrdXIo5
OOQECSplnALZfKr0VC4TBeW+oUZGMoG4rRSM5DfyPFJtlzECQQD8DkWBkhRsP1An
3qfZR8oUkvbaVg9jsCNvoBazYSS3OhsZ96ZSTyf9hJn28wGJmShuZA2eL5XjuTY4
m0fQDhj5AkEA7VzAqKOx5zlFTWXMIzn29uB59m4yJ7UwCyc7tisQA16I8B2HzJzZ
saipkpU2RUYaBrjtWaiVNtyXvZ7mccJpGwJBAMyE4/8bwfiHcwm2z+ktKBqDmUtW
E0ynKkmz01ef1kPaIQ1z9f/JfMBnrOpFCZVVsgnIo4gcQnox2X4a+S0nkzkCQBre
xCSTG2Gclx7S5lAakL2T3dqq0Nyz4zNwBo9xwodPHVtpTGU6YF5/RGsGnzUqYWnf
Z2cd8X5bbIYXxeic5H8CQQCcBOtOdrq9FXsEnyhG5gQXvGdxEAmM2eUs1g8E8kgx
KBTHOaBRQMgvjsdA/obrs7D0HrEbQqGOy7JBYGWZTsiI
-----END RSA PRIVATE KEY-----

--------------------------------- Step #2 -----------------------------------

*** Request: publishing agent -> PaySwarm Authority

GET /payswarm-v1-config HTTP/1.1
Host: payswarm.example.com
Accept: application/ld+json,*/*;q=0.1

*** Response: publishing agent &lt;- PaySwarm Authority

HTTP/1.1 200 OK
Connection: close
Content-Length: 6075
Content-Type: application/ld+json
Date: Wed, 21 Sep 2012 22:30:16 GMT
Host: payswarm.example.com
Server: Apache/2.2.19 (Debian)

{
   "@context": "http://purl.org/payswarm/v1",
   "ps:publicKeyService": "http://payswarm.example.com/api/v1/keys",
   "ps:licenseService": "http://payswarm.example.com/api/v1/licenses",
   "ps:contractsService": "http://payswarm.example.com/api/v1/contracts"
}

--------------------------------- Step #3 -----------------------------------

*** Redirect: user agent &lt;- publishing agent

HTTP/1.1 303 See Other
Location: https://payswarm.example.com/api/v1/keys?public-key=↩
-----BEGIN+PUBLIC+KEY-----%0A↩
MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDptIkqrXhx7YVGsBZ5fY%2FLz0il%0A↩
0LXJrhUY43V%2FlLWdRf7JXY6tcgA5AmwNGZtJRyH79QXCJn%2BBAHUtl6gX2gvjs8N2%0A↩
B5u4m0LtXyaFWtbQV9%2BhY3JRLOBiydPeXLgsnLwKiJ9v4CNXSNA5wT8vYGXiqq0B%0A↩
US89y0M909ZTj2zDQwIDAQAB%0A↩
-----END+PUBLIC+KEY-----↩
&amp;registration-callback=http%3A%2F%2Fpublisher.example.org%2Fregistration-complete?nonce=pn9sueh43jefa
Content-Type: text/html
Content-Length: 174

&lt;html>
 &lt;head>
  &lt;title>Identity Registration&lt;/title>
 &lt;/head>
 &lt;body>
  &lt;h1>Public Key Registration&lt;/h1>
   &lt;p>You must now go to your PaySwarm Authority and 
    &lt;a href="http://payswarm.example.com/api/v1/keys?public-key=↩
-----BEGIN+PUBLIC+KEY-----%0A↩
MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDptIkqrXhx7YVGsBZ5fY%2FLz0il%0A↩
0LXJrhUY43V%2FlLWdRf7JXY6tcgA5AmwNGZtJRyH79QXCJn%2BBAHUtl6gX2gvjs8N2%0A↩
B5u4m0LtXyaFWtbQV9%2BhY3JRLOBiydPeXLgsnLwKiJ9v4CNXSNA5wT8vYGXiqq0B%0A↩
US89y0M909ZTj2zDQwIDAQAB%0A↩
-----END+PUBLIC+KEY-----↩
&amp;registration-callback=http%3A%2F%2Fpublisher.example.org%2Fregistration-complete?nonce=pn9sueh43jefa">
    register your identification information&lt;/a> 
    there.&lt;/p>
 &lt;/body>
&lt;/html>

--------------------------------- Step #4 -----------------------------------

*** This step consists of a series of UI interactions and is thus not
*** specified in this specification.

--------------------------------- Step #5 -----------------------------------

*** The PaySwarm Authority creates a configuration object to return back
*** to the publishing agent

{
   "@type": "ps:Preferences"
   "com:currency": "USD",
   "com:minimumAmount": "0.05",
   "com:maximumRate": "10.0",
   "com:destination": "https://example.com/people/manu/accounts/article-sales",
   "sec:publicKey": "http://payswarm.example.com/i/manu/keys/23",
   "ps:license": "http://purl.org/payswarm/licenses/blogging",
   "ps:licenseHash": "961ec496092bf6ee08d6255d96069b5186332689",
}

*** The configuration object is then encrypted and sent to the 
*** registration-callback specified in the registration request above.

POST registration-complete?nonce=pn9sueh43jefa HTTP/1.1
Host: publisher.example.org
Content-Length: 47
Content-Type: application/ld+json

{
   "@type": "sec:EncryptedMessage",
   "sec:data": "VTJGc2RHVmtYMThOY3h2dnNVN290Zks1dmxWc3labi9sYkU0TGloRTdxY0dpblE4OHgrUXFNNi9l\n↩
a1JMWjdXOApRSGtrbzh6UG5XOFo3WWI4djJBUG1abnlRNW5CVGViWkRGdklpMEliczNWSzRQTGdB\n↩
UFhxYTR2aWFtemwrWGV3Cmw0eFF4ancvOW85dTlEckNURjMrMDBKMVFubGdtci9abkFRSmc5UjdV\n↩
Rk55ckpYalIxZUJuKytaQ0luUTF2cUwKcm5vcDU1eWk3RFVqVnMrRXZZSkx6RVF1VlBVQ0xxdXR4\n↩
L3lvTWd4bkdhSksxOG5ZakdiekJxSGxOYm9pVStUNwpwOTJ1Q0Y0Q2RiR1NqL0U3OUp4Vmh6OXQr\n↩
Mjc2a1V3RUlNY3o2Z3FadXZMU004KzRtWkZiakh6K2N5a1VVQ2xHCi9RcTk3b2o3N2UrYXlhZjhS\n↩
ZmtEZzlUeWk3Q2szREhSblprcy9WWDJWUGhUOEJ5c3RiYndnMnN4eWc5TXhkbHoKUkVESzFvR0FJ\n↩
UDZVQ09NeWJLTGpBUm0zMTRmcWtXSFdDY29mWFNzSGNPRmM2cnp1Wko0RnVWTFNQMGROUkFRRgpB\n↩
bFQ0QUpPbzRBZHpIb2hpTy8vVGhNOTl1U1ZER1NPQ3graFAvY3V4dGNGUFBSRzNrZS8vUk1MVFZO\n↩
YVBlaUp2Ckg4L1ZWUVU4L3dLZUEyeTQ1TzQ2K2lYTnZsOGErbGg0NjRUS3RabktFb009Cg==",
   "sec:encryptionKey": "uATtey0c4nvZIsDIfpFffuCyMYGPKRLIVJCsvedE013SpEJ+1uO7x6SK9hIG9zLWRlPpwmbar2bt\n↩
gTX5NBzYC5+c5ZkXtM1O8REwIJ7wmtLdumRYEbr/TghFl3pAgXhv0mVt8XZ+KLWlxMqXnrT+ByNw\n↩
z7u3IxpqNVcXHExjXQE=",
   "sec:password": "5dTlEckNURjMrMDER1NPQ3graFABKMVFub=",
   "sec:cipher": "aes-128-cbc",
   "sec:iv": "vcDU1eWTy8vVGhNOszREhSblFVqVnGpBUm0zMTRmcWtMrRX==",
   "sec:publicKey": "http://payswarm.example.com/i/manu/keys/23"
}
</pre>
      </section>

      <section>
        <h2>Security Concerns for Registration</h2>

        <ul>
          <li>
All requests to the <tref>PaySwarm Authority</tref> MUST be made using HTTPS
to ensure configuration data is not tampered with in transit.
          </li>
          <li>
The registration request from the <tref>publishing agent</tref> to the
<tref>PaySwarm Authority</tref> MUST contain a <tref>nonce</tref> value
for the <code>registration-callback</code> IRI to protect the 
<tref>publishing agent</tref> against 
<a href="http://en.wikipedia.org/wiki/Replay_attack">replay attacks</a>.
          </li>
        </ul>

      </section>
    </section>

    <section>
      <h2>The Purchase Process</h2>
      <p>
      </p>
      
      <section>
        <h3>Publishing an Asset</h3>
        <p>
An <tref>asset</tref> describes a particular item that is provided as a part 
of a commercial transaction. It is usually an item that can be accessed or 
acquired on the
basis of a sale or rental under the terms of a particular <tref>license</tref>. 
Examples of assets include web pages, music files, video streams, use of virtual
machines by the hour, 3D printer files for on-demand manufacturing, radio 
spectrum and crowd-funded loans and grants.
        </p>

        <p>
The following example describes a web page <tref>asset</tref> with the title 
"PaySwarm in Practice - Full Article #1". The article was created by 
"Digital Bazaar, Inc." and the information in the asset is valid from 
November 28th, 2010 to November 28th, 2011. 
The asset is digitally signed by the person providing it
and thus can be cached, stored and then presented to someone else in a manner
that is verifiable by the receiving party.
        </p>
        <pre class="example prettyprint language-jsonld">
{
   "@context": "http://purl.org/payswarm/v1",
   "@subject": "https://example.org/articles/1#asset",
   "@type": ["ps:Asset", "ps:WebPage"],
   "dc:title": "PaySwarm in Practice",
   "dc:creator": 
   {
      "foaf:name": "Digital Bazaar, Inc.",
   }
   "ps:contentUrl": "https://example.org/articles/1",
   "ps:assetProvider": "https://example.org/person/john-doe#me",
   "ps:authority": "https://payswarm.example.com/about#authority",
   "ps:validFrom": "2010-11-28T00:00:00Z",
   "ps:validUntil": "2011-11-28T00:00:00Z"
   "sec:signature": 
   {
       "@type": "sec:JsonldSignature",
       "sec:signer": "https://payswarm.example.com/people/john-doe#key-5",
       "sec:signatureValue": "OWM3YzI4OGQzNGVkMzV...IyZTk2MzQzNmExMgo="
   }
}
        </pre>
        
      </section>

      <section>
        <h3>Publishing a License</h3>
        <p>
A <tref>license</tref> is a legal description of a licensee's rights to a 
particular <tref>asset</tref>.
Licenses are usually included as a part of a contract to express what a buyer 
may do with the asset that has been purchased.
        </p>
        
        <p>
The following example describes an overly-simplified personal use license.
        </p>
        <pre class="example prettyprint language-jsonld">
{
   "@context": "http://purl.org/payswarm/v1",
   "@subject": "http://payswarm.example.com/licenses/personal-use",
   "@type": "ps:License",
   "dc:format": "text/html",
   "ps:licenseTemplate": "This personal use license allows you to save the 
      purchased item onto any device that you own for your personal enjoyment
      and make up to &lt;span property=\"ex:physicalCopies\" /&gt; printed
      copies of the work for personal use."
   "ps:licenseTerms": 
   {
      "ex:physicalCopies": 5
   }
}
        </pre>

      </section>

      <section>
        <h3>Publishing a Listing</h3>

        <p>
A <tref>listing</tref> describes the combination of an <tref>asset</tref> 
that is for sale under a specific <tref>license</tref> and a set of payment 
terms that must be fulfilled in order to access the asset. Listings are often 
published on websites that sell assets via PaySwarm as a way to express things
that are for sale, in a decentralized manner.
        </p>

        <p>
The following example describes an <tref>asset</tref> for sale 
for $0.05 USD under a <tref>license</tref>
that covers acceptable use of blog posts. The offer is valid from March 2nd 
2011 to March 3rd 2011. The only restriction on additional payees is that the 
<tref>PaySwarm Authority</tref> (the organization processing the payment) 
may only take a maximum of 10% of the final sale price to cover their fees.
        </p>

        <pre class="example prettyprint language-jsonld">
{
   "@context": "http://purl.org/payswarm/v1",
   "@subject": "http://example.com/articles/1#listing",
   "@type": ["gr:Offering", "ps:Listing"],
   "com:payee": 
   [
      {
         "@subject": "http://example.com/articles/1#listing-payee",
         "@type": "com:Payee",
         "com:currency": "USD",
         "com:destination": "https://payswarm.example.com/i/bob/accounts/primary",
         "com:rate": "0.05",
         "com:rateType": "com:FlatAmount",
         "rdfs:comment": "Payment for PaySwarm in Practice by Digital Bazaar."
      }
   ],
   "com:payeeRule": 
   [
      {
         "@type": "com:PayeeRule",
         "com:destinationOwnerType": "ps:Authority",
         "com:maximumRate": "10",
         "com:rateType": "com:InclusivePercentage"
      }
   ],
   "ps:asset": "http://example.com/articles/1#asset",
   "ps:assetHash": "14618b56ff597a2fed560db9aa0610fe442106a4",
   "ps:assetProvider": "https://payswarm.example.com/i/bob",
   "ps:license": "http://payswarm.example.com/licenses/blogging",
   "ps:licenseHash": "0d8866836917f8ef58af44accb6efab9a10610ad",
   "sec:signature": 
   {
      "@type": "ps:JsonldSignature",
      "dc:created": "2011-03-02T00:00:00Z",
      "dc:creator": "https://payswarm.example.com/i/bob/keys/4",
      "sec:signatureValue": "KXtwA5kXZBJzj1rkPMJmGDROjM+fpi2cJIB+Xqf10="
   },
   "ps:validFrom": "2011-03-02T00:00:00+0000",
   "ps:validUntil": "2011-03-03T00:00:00+0000"
}
        </pre>

      </section>

      <section>
        <h3>Authorizing a Payment Session</h3>

        <p>
        </p>
      </section>

      <section>
        <h3>Performing a Purchase</h3>

        <p>
        </p>
      </section>

      <section>
        <h3>The Contract</h3>

        <p>
A <tref>contract</tref> is the result of a commercial transaction in PaySwarm 
and contains information such as the <tref>listing</tref>, 
the <tref>asset</tref> that was purchased, the parties involved in the
transaction, the <tref>license</tref> outlining the rights to the 
asset, and payment information associated with the transaction.
        </p>

        <p>
The following example describes a purchase that occurred on March 2nd 2011
for a Web-based article called "PaySwarm in Practice". The article was authored
and listed for sale by Bob Smith and a personal use license was acquired by 
Jane, who may now peruse the article.
        </p>

        <pre class="example prettyprint language-jsonld">
{
   "@context": "http://purl.org/payswarm/v1",
   "@subject": "http://payswarm.example.com/contracts/28394729347",
   "@type": ["ps:Transaction", "ps:Contract"],
   "com:amount": "0.05",
   "com:currency": "USD",
   "com:date": "2011-03-02T03:00:53Z",
   "com:payee": 
   [
      {
         "@type": "com:Payee",
         "com:currency": "USD",
         "com:destination": "https://payswarm.example.com/i/authority/accounts/main",
         "com:payeePosition": 0,
         "com:rate": "10.00",
         "com:rateContext": "com:TaxExempt",
         "com:rateType": "com:InclusivePercentage",
         "rdfs:comment": "PaySwarm Authority Transaction Processing"
      }
   ],
   "com:transfer": 
   [
      {
         "@type": "com:Transfer",
         "com:amount": "0.045",
         "com:currency": "USD",
         "com:destination": "https://payswarm.example.com/i/bob/accounts/primary",
         "com:forTransaction": "http://payswarm.example.com/contracts/28394729347",
         "com:source": "https://payswarm.example.com/i/jane/accounts/primary",
         "rdfs:comment": "Payment for PaySwarm in Practice by Bob Smith."
      },
      {
         "@type": "com:Transfer",
         "com:amount": "0.005",
         "com:currency": "USD",
         "com:destination": "https://payswarm.example.com/i/authority/accounts/main",
         "com:forTransaction": "http://payswarm.example.com/contracts/28394729347",
         "com:source": "https://payswarm.example.com/i/jane/accounts/primary",
         "rdfs:comment": "PaySwarm Authority Transaction Processing"
      }
   ],
   "dc:created": "2011-03-02T03:00:53Z",
   "ps:asset": 
   {
      "@subject": "http://example.com/articles/1#asset",
      "@type": ["ps:Asset", "ps:WebPage"],
      "dc:creator": 
      {
         "foaf:name": "Bob Smith"
      },
      "dc:title": "PaySwarm in Practice",
      "ps:assetProvider": "https://payswarm.example.com/i/bob",
      "ps:authority": "https://payswarm.example.com/client-config",
      "ps:contentUrl": "http://example.com/articles/1",
      "sec:signature": 
      {
         "@type": "ps:JsonldSignature",
         "dc:created": "2011-03-02T00:00:00Z",
         "dc:creator": "https://payswarm.example.com/i/bob/keys/4",
         "sec:signatureValue": "XuLEGuq+ne56Qsc5Nic8I="
      }
   },
   "ps:assetAcquirer": "https://payswarm.example.com/i/jane",
   "ps:assetProviderIdentity": 
   {
      "ps:identityHash": "df913752be56fe0d37dcedc2d7f44708373d2a68"
   },
   "ps:license": 
   {
      "@subject": "http://payswarm.example.com/licenses/blogging",
      "@type": "ps:License",
      "dc:format": "text/html",
      "ps:licenseTemplate": "Personal Use License ..."
   },
   "ps:listing": 
   {
      "@subject": "http://example.com/articles/1#listing",
      "@type": ["gr:Offering", "ps:Listing"],
      "com:payee": 
      [
         {
            "@subject": "http://example.com/articles/1#listing-payee",
            "@type": "com:Payee",
            "com:currency": "USD",
            "com:destination": "https://payswarm.example.com/i/bob/accounts/primary",
            "com:rate": "0.05",
            "com:rateType": "com:FlatAmount",
            "rdfs:comment": "Payment for PaySwarm in Practice by Digital Bazaar."
         }
      ],
      "com:payeeRule": 
      [
         {
            "@type": "com:PayeeRule",
            "com:destinationOwnerType": "ps:Authority",
            "com:maximumRate": "10",
            "com:rateType": "com:InclusivePercentage"
         }
      ],
      "ps:asset": "http://example.com/articles/1#asset",
      "ps:assetHash": "14618b56ff597a2fed560db9aa0610fe442106a4",
      "ps:license": "http://payswarm.example.com/licenses/blogging",
      "ps:licenseHash": "0d8866836917f8ef58af44accb6efab9a10610ad",
      "sec:signature": 
      {
         "@type": "ps:JsonldSignature",
         "dc:created": "2011-03-02T00:00:00Z",
         "dc:creator": "https://payswarm.example.com/i/bob/keys/4",
         "sec:signatureValue": "KXtwA5kXZBJzj1rkPMJmGDROjM+fpi2cJIB+Xqf10="
      },
      "ps:validFrom": "2011-03-02T00:00:00+0000",
      "ps:validUntil": "2011-03-03T00:00:00+0000"
   },
   "ps:listingHash": "1acbd23c3a7d8827270a959a2760f7c4ded98022",
   "sec:signature": 
   {
      "@type": "ps:JsonldSignature",
      "dc:created": "2011-03-02T03:00:53Z",
      "dc:creator": "https://payswarm.example.com/i/authority/keys/1",
      "sec:signatureValue": "ZnGaAs0QCIfEAvCsj2TxRTs8ekQrbbQUXvTLWcQ0kQ=="
   }
}
        </pre>

      </section>

      <section>
        <h3>Verifying a Purchase</h3>

      </section>
    </section>

    <section>
      <h2>The PaySwarm API</h2>
    </section>

    <section>
      <h2>Implementation Details</h2>

      <section>
        <h3>Digital Signatures</h3>

        <section>
          <h4>Signing</h4>

        </section>

        <section>
          <h4>Verifying</h4>

        </section>
      </section>
    </section>

    <section>
      <h2>Data Portability</h2>
      <p>
One of the freedoms that is ensured by this specification is the freedom to
own your data and move it to a PaySwarm Authority of your choosing. That is,
your transaction history is your property and therefore you must be able to
move it to a location of your choosing at will. In order to ensure that this
freedom is protected, data portability MUST be implemented by all conforming 
implementations of this specification.
      </p>

      <section>
        <h3>Transfering Purchase History</h3>

      </section>

    </section>

    <section>
      <h2>Security Concerns</h2>
      <p>
      </p>

      <section>
        <h3>Identity Management</h3>
        <p>
        </p>
      </section>

      <section>
        <h3>Digital Signatures</h3>
        <p>
        </p>
      </section>

      <section>
        <h3>Identifying and Removing Troublemakers</h3>
        <p>
        </p>
      </section>

      <section>
        <h3>Halting Asset Distribution</h3>
        <p>
        </p>
      </section>
    </section>

  </body> 
</html>

